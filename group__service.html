<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bio: Service</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">bio
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__service.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a>  </div>
  <div class="headertitle"><div class="title">Service</div></div>
</div><!--header-->
<div class="contents">

<p>Idiomatic coroutine interaction.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbio__service__msg__base__t.html">bio_service_msg_base_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The base for a message type of a service.  <a href="structbio__service__msg__base__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga1c4df06d5f793a5b6ec8b25221528d15" id="r_ga1c4df06d5f793a5b6ec8b25221528d15"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a>(T)</td></tr>
<tr class="memdesc:ga1c4df06d5f793a5b6ec8b25221528d15"><td class="mdescLeft">&#160;</td><td class="mdescRight">A service reference struct.  <br /></td></tr>
<tr class="separator:ga1c4df06d5f793a5b6ec8b25221528d15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga973c1cd2edcbf0afbe7d5f13b47a1c48" id="r_ga973c1cd2edcbf0afbe7d5f13b47a1c48"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga973c1cd2edcbf0afbe7d5f13b47a1c48">BIO_SERVICE_MSG</a>&#160;&#160;&#160;<a class="el" href="structbio__service__msg__base__t.html">bio_service_msg_base_t</a> bio__service_msg_base;</td></tr>
<tr class="memdesc:ga973c1cd2edcbf0afbe7d5f13b47a1c48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper to include <a class="el" href="structbio__service__msg__base__t.html">bio_service_msg_base_t</a> in a message type.  <br /></td></tr>
<tr class="separator:ga973c1cd2edcbf0afbe7d5f13b47a1c48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad85fb81220dadbf8263aa7cc8ba33fa5" id="r_gad85fb81220dadbf8263aa7cc8ba33fa5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5">bio_start_service</a>(ptr,  entry,  args,  mailbox_capacity)</td></tr>
<tr class="memdesc:gad85fb81220dadbf8263aa7cc8ba33fa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start a service coroutine.  <br /></td></tr>
<tr class="separator:gad85fb81220dadbf8263aa7cc8ba33fa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb9a8cd5a3721cd2ab34e4129de9fb93" id="r_gadb9a8cd5a3721cd2ab34e4129de9fb93"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#gadb9a8cd5a3721cd2ab34e4129de9fb93">bio_stop_service</a>(service)&#160;&#160;&#160;	bio__service_stop((service).coro, (service).mailbox.bio__handle)</td></tr>
<tr class="memdesc:gadb9a8cd5a3721cd2ab34e4129de9fb93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop a service.  <br /></td></tr>
<tr class="separator:gadb9a8cd5a3721cd2ab34e4129de9fb93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a5915441f5cf405f893a9eb22d3e3f0" id="r_ga0a5915441f5cf405f893a9eb22d3e3f0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga0a5915441f5cf405f893a9eb22d3e3f0">bio_get_service_info</a>(userdata,  mailbox_ptr,  args_ptr)&#160;&#160;&#160;	bio__service_get_info(userdata, &amp;(mailbox_ptr)-&gt;bio__handle, args_ptr)</td></tr>
<tr class="memdesc:ga0a5915441f5cf405f893a9eb22d3e3f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">The service entrypoint must call this as soon as possible.  <br /></td></tr>
<tr class="separator:ga0a5915441f5cf405f893a9eb22d3e3f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga955af950234d8b2b422e64b78ca7c93c" id="r_ga955af950234d8b2b422e64b78ca7c93c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a>(service,  message,  cancel_signal)</td></tr>
<tr class="memdesc:ga955af950234d8b2b422e64b78ca7c93c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make a synchronous service call.  <br /></td></tr>
<tr class="separator:ga955af950234d8b2b422e64b78ca7c93c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1528d9454cb2120ca2914a863637b80e" id="r_ga1528d9454cb2120ca2914a863637b80e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga1528d9454cb2120ca2914a863637b80e">bio_service_state</a>(service)&#160;&#160;&#160;	<a class="el" href="group__coro.html#gaed9911140a74eb570e214fcc0ecc44e7">bio_coro_state</a>((service).coro)</td></tr>
<tr class="memdesc:ga1528d9454cb2120ca2914a863637b80e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check a service's state.  <br /></td></tr>
<tr class="separator:ga1528d9454cb2120ca2914a863637b80e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadaa872e1cbc9da07565e2d4b54df1f9e" id="r_gadaa872e1cbc9da07565e2d4b54df1f9e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#gadaa872e1cbc9da07565e2d4b54df1f9e">bio_notify_service</a>(service,  message,  retry_condition)</td></tr>
<tr class="memdesc:gadaa872e1cbc9da07565e2d4b54df1f9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a notification to a service.  <br /></td></tr>
<tr class="separator:gadaa872e1cbc9da07565e2d4b54df1f9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga49ff241d09bde2da1e564e700f909368" id="r_ga49ff241d09bde2da1e564e700f909368"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga49ff241d09bde2da1e564e700f909368">bio_is_call_cancelled</a>(msg)&#160;&#160;&#160;	bio__service_is_call_cancelled(&amp;(msg).bio__service_msg_base)</td></tr>
<tr class="memdesc:ga49ff241d09bde2da1e564e700f909368"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a call was cancelled.  <br /></td></tr>
<tr class="separator:ga49ff241d09bde2da1e564e700f909368"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3f03d9d9599baa4177baf2ce940688c5" id="r_ga3f03d9d9599baa4177baf2ce940688c5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#ga3f03d9d9599baa4177baf2ce940688c5">bio_service_loop</a>(msg,  mailbox)</td></tr>
<tr class="memdesc:ga3f03d9d9599baa4177baf2ce940688c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message loop helper for the service.  <br /></td></tr>
<tr class="separator:ga3f03d9d9599baa4177baf2ce940688c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab20e348daa8e74079afab41baee2c011" id="r_gab20e348daa8e74079afab41baee2c011"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg)</td></tr>
<tr class="memdesc:gab20e348daa8e74079afab41baee2c011"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper for cancellable service call.  <br /></td></tr>
<tr class="separator:gab20e348daa8e74079afab41baee2c011"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gaa4b6b490e1bdb2b2eef15deca482ab12" id="r_gaa4b6b490e1bdb2b2eef15deca482ab12"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a> { <a class="el" href="group__service.html#ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4">BIO_CALL_OK</a>
, <a class="el" href="group__service.html#ggaa4b6b490e1bdb2b2eef15deca482ab12a1e5c49aece3542ff126e79a0eab9af7f">BIO_CALL_CANCELLED</a>
, <a class="el" href="group__service.html#ggaa4b6b490e1bdb2b2eef15deca482ab12a162f386644d2fcd631612a606219a076">BIO_CALL_TARGET_DEAD</a>
 }</td></tr>
<tr class="memdesc:gaa4b6b490e1bdb2b2eef15deca482ab12"><td class="mdescLeft">&#160;</td><td class="mdescRight">The status of a call using <a class="el" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a>.  <a href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">More...</a><br /></td></tr>
<tr class="separator:gaa4b6b490e1bdb2b2eef15deca482ab12"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Idiomatic coroutine interaction. </p>
<p>This is inspired by Erlang's <a href="https://www.erlang.org/doc/apps/stdlib/gen_server.html">gen_server</a> and <a href="https://www.erlang.org/doc/apps/stdlib/proc_lib.html">proc_lib</a>.</p>
<p>bio already provides <a class="el" href="group__coro.html">Coroutine</a> and <a class="el" href="group__mailbox.html">Mailbox</a>. However, there are several higher-level concerns that it does not address:</p>
<ul>
<li>How to handle request/response type interaction between coroutines.</li>
<li>Lifetime of data passed between coroutines. What would happen if either the sender or the receiver has terminated?</li>
</ul>
<p>This module offers a simple way to deal with the above concerns.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <a class="code hl_define" href="group__service.html#ga973c1cd2edcbf0afbe7d5f13b47a1c48">BIO_SERVICE_MSG</a>  <span class="comment">// Required header</span></div>
<div class="line">    <span class="keywordtype">int</span> lhs;</div>
<div class="line">    <span class="keywordtype">int</span> rhs;</div>
<div class="line">    <span class="keywordtype">int</span>* result;</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> service_entry(<span class="keywordtype">void</span>* userdata) {</div>
<div class="line">    <span class="keywordtype">int</span> start_arg;</div>
<div class="line">    <a class="code hl_define" href="group__mailbox.html#ga3aecbab6cea09bc10aa363b7dfa2e586">BIO_MAILBOX</a>(msg_t) mailbox;</div>
<div class="line">    <a class="code hl_define" href="group__service.html#ga0a5915441f5cf405f893a9eb22d3e3f0">bio_get_service_info</a>(userdata, &amp;mailbox, &amp;start_arg);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__service.html#ga3f03d9d9599baa4177baf2ce940688c5">bio_service_loop</a>(msg, mailbox) {</div>
<div class="line">        <span class="comment">// Calculate first, which may cause context switch</span></div>
<div class="line">        <span class="keywordtype">int</span> result = msg.lhs + msg.rhs;</div>
<div class="line">        <span class="comment">// Then write result in the bio_respond block</span></div>
<div class="line">        <a class="code hl_define" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg) {</div>
<div class="line">            *msg.result = result;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The mailbox will be closed by the service module</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> use_service(<span class="keywordtype">void</span>) {</div>
<div class="line">    <a class="code hl_define" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a>(msg_t) adder;</div>
<div class="line">    <span class="comment">// Start argument is stack-allocated</span></div>
<div class="line">    <span class="keywordtype">int</span> start_arg = 42;</div>
<div class="line">    <a class="code hl_define" href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5">bio_start_service</a>(&amp;adder, service_entry, start_arg, 4);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="structbio__signal__t.html">bio_signal_t</a> no_cancel = { 0 };</div>
<div class="line">    <span class="keywordtype">int</span> result;</div>
<div class="line">    msg_t msg = {</div>
<div class="line">        .lhs = 1,</div>
<div class="line">        .rhs = 2,</div>
<div class="line">        <span class="comment">// Write result to a stack-allocated variable</span></div>
<div class="line">        .result = &amp;result,</div>
<div class="line">    };</div>
<div class="line">    <a class="code hl_enumeration" href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a> status = <a class="code hl_define" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a>(adder, msg, no_cancel);</div>
<div class="line">    <span class="keywordflow">if</span> (status == <a class="code hl_enumvalue" href="group__service.html#ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4">BIO_CALL_OK</a>) {</div>
<div class="line">        <a class="code hl_define" href="group__logging.html#ga92813c805769c27992b4704dfe21c241">BIO_INFO</a>(<span class="stringliteral">&quot;The result is: %d&quot;</span>, result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__service.html#gadb9a8cd5a3721cd2ab34e4129de9fb93">bio_stop_service</a>(adder);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__logging_html_ga92813c805769c27992b4704dfe21c241"><div class="ttname"><a href="group__logging.html#ga92813c805769c27992b4704dfe21c241">BIO_INFO</a></div><div class="ttdeci">#define BIO_INFO(...)</div><div class="ttdoc">Log a message at BIO_LOG_LEVEL_DEBUG level.</div><div class="ttdef"><b>Definition</b> bio.h:48</div></div>
<div class="ttc" id="agroup__mailbox_html_ga3aecbab6cea09bc10aa363b7dfa2e586"><div class="ttname"><a href="group__mailbox.html#ga3aecbab6cea09bc10aa363b7dfa2e586">BIO_MAILBOX</a></div><div class="ttdeci">#define BIO_MAILBOX(T)</div><div class="ttdoc">Define a mailbox type.</div><div class="ttdef"><b>Definition</b> mailbox.h:97</div></div>
<div class="ttc" id="agroup__service_html_ga0a5915441f5cf405f893a9eb22d3e3f0"><div class="ttname"><a href="group__service.html#ga0a5915441f5cf405f893a9eb22d3e3f0">bio_get_service_info</a></div><div class="ttdeci">#define bio_get_service_info(userdata, mailbox_ptr, args_ptr)</div><div class="ttdoc">The service entrypoint must call this as soon as possible.</div><div class="ttdef"><b>Definition</b> service.h:120</div></div>
<div class="ttc" id="agroup__service_html_ga1c4df06d5f793a5b6ec8b25221528d15"><div class="ttname"><a href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a></div><div class="ttdeci">#define BIO_SERVICE(T)</div><div class="ttdoc">A service reference struct.</div><div class="ttdef"><b>Definition</b> service.h:64</div></div>
<div class="ttc" id="agroup__service_html_ga3f03d9d9599baa4177baf2ce940688c5"><div class="ttname"><a href="group__service.html#ga3f03d9d9599baa4177baf2ce940688c5">bio_service_loop</a></div><div class="ttdeci">#define bio_service_loop(msg, mailbox)</div><div class="ttdoc">Message loop helper for the service.</div><div class="ttdef"><b>Definition</b> service.h:217</div></div>
<div class="ttc" id="agroup__service_html_ga955af950234d8b2b422e64b78ca7c93c"><div class="ttname"><a href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a></div><div class="ttdeci">#define bio_call_service(service, message, cancel_signal)</div><div class="ttdoc">Make a synchronous service call.</div><div class="ttdef"><b>Definition</b> service.h:148</div></div>
<div class="ttc" id="agroup__service_html_ga973c1cd2edcbf0afbe7d5f13b47a1c48"><div class="ttname"><a href="group__service.html#ga973c1cd2edcbf0afbe7d5f13b47a1c48">BIO_SERVICE_MSG</a></div><div class="ttdeci">#define BIO_SERVICE_MSG</div><div class="ttdoc">Helper to include bio_service_msg_base_t in a message type.</div><div class="ttdef"><b>Definition</b> service.h:71</div></div>
<div class="ttc" id="agroup__service_html_gaa4b6b490e1bdb2b2eef15deca482ab12"><div class="ttname"><a href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a></div><div class="ttdeci">bio_call_status_t</div><div class="ttdoc">The status of a call using bio_call_service.</div><div class="ttdef"><b>Definition</b> service.h:39</div></div>
<div class="ttc" id="agroup__service_html_gab20e348daa8e74079afab41baee2c011"><div class="ttname"><a href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a></div><div class="ttdeci">#define bio_respond(msg)</div><div class="ttdoc">Helper for cancellable service call.</div><div class="ttdef"><b>Definition</b> service.h:284</div></div>
<div class="ttc" id="agroup__service_html_gad85fb81220dadbf8263aa7cc8ba33fa5"><div class="ttname"><a href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5">bio_start_service</a></div><div class="ttdeci">#define bio_start_service(ptr, entry, args, mailbox_capacity)</div><div class="ttdoc">Start a service coroutine.</div><div class="ttdef"><b>Definition</b> service.h:88</div></div>
<div class="ttc" id="agroup__service_html_gadb9a8cd5a3721cd2ab34e4129de9fb93"><div class="ttname"><a href="group__service.html#gadb9a8cd5a3721cd2ab34e4129de9fb93">bio_stop_service</a></div><div class="ttdeci">#define bio_stop_service(service)</div><div class="ttdoc">Stop a service.</div><div class="ttdef"><b>Definition</b> service.h:109</div></div>
<div class="ttc" id="agroup__service_html_ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4"><div class="ttname"><a href="group__service.html#ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4">BIO_CALL_OK</a></div><div class="ttdeci">@ BIO_CALL_OK</div><div class="ttdoc">The call was handled by the service.</div><div class="ttdef"><b>Definition</b> service.h:41</div></div>
<div class="ttc" id="astructbio__signal__t_html"><div class="ttname"><a href="structbio__signal__t.html">bio_signal_t</a></div><div class="ttdoc">Handle to a signal.</div><div class="ttdef"><b>Definition</b> bio.h:147</div></div>
</div><!-- fragment --><p>In the above example, the service consumer makes use of several stack-allocated values. This is typical for C code. They would be invalid to access if it has terminated. However, the service modules provide several guarantee so that it is safe to do so. These will be explained in this document. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga955af950234d8b2b422e64b78ca7c93c" name="ga955af950234d8b2b422e64b78ca7c93c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga955af950234d8b2b422e64b78ca7c93c">&#9670;&#160;</a></span>bio_call_service</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_call_service</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">service, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">message, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cancel_signal&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    ( \</div>
<div class="line">        BIO__TYPECHECK_EXP((message), *((service).mailbox.bio__message)), \</div>
<div class="line">        bio__service_call( \</div>
<div class="line">            (service).coro, \</div>
<div class="line">            (service).mailbox.bio__handle, \</div>
<div class="line">            &amp;((message).bio__service_msg_base), \</div>
<div class="line">            &amp;(message), \</div>
<div class="line">            <span class="keyword">sizeof</span>(message), \</div>
<div class="line">            cancel_signal \</div>
<div class="line">        ) \</div>
<div class="line">    )</div>
</div><!-- fragment -->
<p>Make a synchronous service call. </p>
<p>The calling coroutine will be suspended until one of the following happens:</p>
<ul>
<li>The service responds to the call.</li>
<li>The service terminates before or during the call.</li>
<li>The call is cancelled.</li>
</ul>
<p>The message may contain pointers to stack-allocated variables or resources that will be freed when the calling coroutine terminates as long as both the caller and the callee follow the guidelines in this document.</p>
<p>To implement service call with timeout, something like this can be used:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> call_with_timeout(<span class="keywordtype">void</span>) {</div>
<div class="line">    <a class="code hl_define" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a>(msg_t) adder;  <span class="comment">// Assume we retrieved this somehow</span></div>
<div class="line">    <a class="code hl_struct" href="structbio__signal__t.html">bio_signal_t</a> cancel = <a class="code hl_function" href="group__signal.html#ga38cd6e3e58864cbf19fc86ff352bb44a">bio_make_signal</a>();</div>
<div class="line">    <a class="code hl_function" href="group__signal.html#ga9ebb8779379b5455f238c652a8937617">bio_raise_signal_after</a>(cancel, 2000);  <span class="comment">// Allow 2s before cancelling</span></div>
<div class="line">    <span class="keywordtype">int</span> result;</div>
<div class="line">    msg_t msg = {</div>
<div class="line">        .lhs = 1,</div>
<div class="line">        .rhs = 2,</div>
<div class="line">        <span class="comment">// Write result to a stack-allocated variable</span></div>
<div class="line">        .result = &amp;result,</div>
<div class="line">    };</div>
<div class="line">    <a class="code hl_enumeration" href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a> status = <a class="code hl_define" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a>(adder, msg, cancel);</div>
<div class="line">    <span class="comment">// status might be BIO_CALL_CANCELLED</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__signal_html_ga38cd6e3e58864cbf19fc86ff352bb44a"><div class="ttname"><a href="group__signal.html#ga38cd6e3e58864cbf19fc86ff352bb44a">bio_make_signal</a></div><div class="ttdeci">bio_signal_t bio_make_signal(void)</div><div class="ttdoc">Create a new signal.</div></div>
<div class="ttc" id="agroup__signal_html_ga9ebb8779379b5455f238c652a8937617"><div class="ttname"><a href="group__signal.html#ga9ebb8779379b5455f238c652a8937617">bio_raise_signal_after</a></div><div class="ttdeci">void bio_raise_signal_after(bio_signal_t signal, bio_time_t time_ms)</div><div class="ttdoc">Raise a signal after a delay.</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">service</td><td>The service handle </td></tr>
    <tr><td class="paramname">message</td><td>The message for this call </td></tr>
    <tr><td class="paramname">cancel_signal</td><td>Cancel signal for this call. If an invalid handle is passed, this call will not be cancellable. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value of type <a class="el" href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a></dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5" title="Start a service coroutine.">bio_start_service</a> </dd></dl>

</div>
</div>
<a id="ga0a5915441f5cf405f893a9eb22d3e3f0" name="ga0a5915441f5cf405f893a9eb22d3e3f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0a5915441f5cf405f893a9eb22d3e3f0">&#9670;&#160;</a></span>bio_get_service_info</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_get_service_info</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">userdata, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mailbox_ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">args_ptr&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	bio__service_get_info(userdata, &amp;(mailbox_ptr)-&gt;bio__handle, args_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The service entrypoint must call this as soon as possible. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">userdata</td><td>The userdata from the coroutine entrypoint. </td></tr>
    <tr><td class="paramname">mailbox_ptr</td><td>Pointer to a mailbox variable of the appropriate message type. </td></tr>
    <tr><td class="paramname">args_ptr</td><td>Pointer to a variable of the same type as <code>args</code> that was passed to <a class="el" href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5">bio_start_service</a> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga49ff241d09bde2da1e564e700f909368" name="ga49ff241d09bde2da1e564e700f909368"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga49ff241d09bde2da1e564e700f909368">&#9670;&#160;</a></span>bio_is_call_cancelled</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_is_call_cancelled</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msg</td><td>)</td>
          <td>&#160;&#160;&#160;	bio__service_is_call_cancelled(&amp;(msg).bio__service_msg_base)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether a call was cancelled. </p>
<p>The service handler would typically call this after it has done something that involves context-switching (e.g: querying a database).</p>
<p>If this returns true, the service can stop its handler early. In addition, if the respond involves allocating some resources, they should be freed as the caller is no longer interested in the result.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The message from a caller. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether the call was cancelled. </dd></dl>

</div>
</div>
<a id="gadaa872e1cbc9da07565e2d4b54df1f9e" name="gadaa872e1cbc9da07565e2d4b54df1f9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadaa872e1cbc9da07565e2d4b54df1f9e">&#9670;&#160;</a></span>bio_notify_service</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_notify_service</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">service, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">message, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">retry_condition&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <a class="code hl_define" href="group__mailbox.html#gadd2b9bb97deb42eec12a4d1c227f41c5">bio_wait_and_send_message</a>( \</div>
<div class="line">        ((<a class="code hl_define" href="group__service.html#ga1528d9454cb2120ca2914a863637b80e">bio_service_state</a>(service) != <a class="code hl_enumvalue" href="group__coro.html#gga94f6989d9bb01e8af4b14575643ae55ca07f18b2b5552c168a8cba22a9cd46214">BIO_CORO_DEAD</a>) &amp;&amp; (retry_condition)), \</div>
<div class="line">        (service).mailbox, \</div>
<div class="line">        (message) \</div>
<div class="line">    )</div>
<div class="ttc" id="agroup__coro_html_gga94f6989d9bb01e8af4b14575643ae55ca07f18b2b5552c168a8cba22a9cd46214"><div class="ttname"><a href="group__coro.html#gga94f6989d9bb01e8af4b14575643ae55ca07f18b2b5552c168a8cba22a9cd46214">BIO_CORO_DEAD</a></div><div class="ttdeci">@ BIO_CORO_DEAD</div><div class="ttdoc">The coroutine has terminated.</div><div class="ttdef"><b>Definition</b> bio.h:512</div></div>
<div class="ttc" id="agroup__mailbox_html_gadd2b9bb97deb42eec12a4d1c227f41c5"><div class="ttname"><a href="group__mailbox.html#gadd2b9bb97deb42eec12a4d1c227f41c5">bio_wait_and_send_message</a></div><div class="ttdeci">#define bio_wait_and_send_message(condition, mailbox, message)</div><div class="ttdoc">A more reliable way to send message.</div><div class="ttdef"><b>Definition</b> mailbox.h:176</div></div>
<div class="ttc" id="agroup__service_html_ga1528d9454cb2120ca2914a863637b80e"><div class="ttname"><a href="group__service.html#ga1528d9454cb2120ca2914a863637b80e">bio_service_state</a></div><div class="ttdeci">#define bio_service_state(service)</div><div class="ttdoc">Check a service's state.</div><div class="ttdef"><b>Definition</b> service.h:167</div></div>
</div><!-- fragment -->
<p>Send a notification to a service. </p>
<p>This is similar to <a class="el" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a> but a respond is not expected. The calling coroutine might suspend until the message has been delivered or the service has terminated prematurely.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">service</td><td>A variable of type <a class="el" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a> </td></tr>
    <tr><td class="paramname">message</td><td>A message for the service </td></tr>
    <tr><td class="paramname">retry_condition</td><td>A boolean expression</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__mailbox.html#ga592bd4227a7e415ff82c30599c570656" title="Attempt to send a message to a mailbox.">bio_send_message</a> </dd></dl>

</div>
</div>
<a id="gab20e348daa8e74079afab41baee2c011" name="gab20e348daa8e74079afab41baee2c011"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab20e348daa8e74079afab41baee2c011">&#9670;&#160;</a></span>bio_respond</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_respond</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msg</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">for</span> ( \</div>
<div class="line">        <span class="keywordtype">bool</span> bio__should_respond = bio_begin_response(msg); \</div>
<div class="line">        bio__should_respond; \</div>
<div class="line">        bio__should_respond = <span class="keyword">false</span>, bio_end_response(msg) \</div>
<div class="line">    )</div>
</div><!-- fragment -->
<p>Helper for cancellable service call. </p>
<p>Instead of writing the result directly to the request message, the service should do its computation using local variables first. Only at the final step, it would write the result in a <code>bio_respond</code> block:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg) {</div>
<div class="line">    *msg.result = result;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is to ensure that if the call has been cancelled and the caller has terminated, the write would not be executed.</p>
<p>If the result involves resource allocation, the service should check whether that is needed before responding:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!<a class="code hl_define" href="group__service.html#ga49ff241d09bde2da1e564e700f909368">bio_is_call_cancelled</a>(msg)) {</div>
<div class="line">    <a class="code hl_define" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg) {</div>
<div class="line">        *msg.result = malloc(...);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__service_html_ga49ff241d09bde2da1e564e700f909368"><div class="ttname"><a href="group__service.html#ga49ff241d09bde2da1e564e700f909368">bio_is_call_cancelled</a></div><div class="ttdeci">#define bio_is_call_cancelled(msg)</div><div class="ttdoc">Check whether a call was cancelled.</div><div class="ttdef"><b>Definition</b> service.h:203</div></div>
</div><!-- fragment --><p>Alternatively, the service might have allocated resources before hand and they should be freed upon cancellation:</p>
<div class="fragment"><div class="line"><span class="comment">// Allocate resource for computation</span></div>
<div class="line">resource_t* resource = alloc_resource();</div>
<div class="line"><span class="comment">// Do computation</span></div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"><span class="comment">// The call might be cancelled by this point</span></div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_define" href="group__service.html#ga49ff241d09bde2da1e564e700f909368">bio_is_call_cancelled</a>(msg)) {</div>
<div class="line">    <a class="code hl_define" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg) {</div>
<div class="line">        *msg.result = resource;</div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// There is no one to receive this</span></div>
<div class="line">    free_resource(resource);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The response writing code block will also be skipped if the caller uses <a class="el" href="group__service.html#gadaa872e1cbc9da07565e2d4b54df1f9e">bio_notify_service</a> to send the request message. Thus, it is safe, albeit potentially inefficient to use mismatched service call types: Sending a notification using a message type with call semantics.</p>
<p>This must be called to resume the caller's execution, otherwise the caller might be suspended indefinitely. In a <code>void</code> but synchrnous service call, use an empty block:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__service.html#gab20e348daa8e74079afab41baee2c011">bio_respond</a>(msg) {}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga1c4df06d5f793a5b6ec8b25221528d15" name="ga1c4df06d5f793a5b6ec8b25221528d15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1c4df06d5f793a5b6ec8b25221528d15">&#9670;&#160;</a></span>BIO_SERVICE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BIO_SERVICE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">T</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keyword">struct </span>{ \</div>
<div class="line">        <a class="code hl_struct" href="structbio__coro__t.html">bio_coro_t</a> coro; \</div>
<div class="line">        BIO_MAILBOX(T) mailbox; \</div>
<div class="line">    }</div>
<div class="ttc" id="astructbio__coro__t_html"><div class="ttname"><a href="structbio__coro__t.html">bio_coro_t</a></div><div class="ttdoc">Handle to a coroutine.</div><div class="ttdef"><b>Definition</b> bio.h:137</div></div>
</div><!-- fragment -->
<p>A service reference struct. </p>
<p>This is a combination of a <a class="el" href="structbio__coro__t.html">bio_coro_t</a> handle and a <a class="el" href="group__mailbox.html#ga3aecbab6cea09bc10aa363b7dfa2e586">BIO_MAILBOX</a> handle </p>

</div>
</div>
<a id="ga3f03d9d9599baa4177baf2ce940688c5" name="ga3f03d9d9599baa4177baf2ce940688c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3f03d9d9599baa4177baf2ce940688c5">&#9670;&#160;</a></span>bio_service_loop</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_service_loop</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mailbox&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <a class="code hl_define" href="group__mailbox.html#ga090313e3f82988032834b960b6af9697">bio_foreach_message</a>(msg, mailbox) \</div>
<div class="line">        for ( \</div>
<div class="line">            <span class="keywordtype">int</span> bio__svc_loop = 0; \</div>
<div class="line">            (bio__svc_loop &lt; 1) &amp;&amp; !<a class="code hl_define" href="group__service.html#ga49ff241d09bde2da1e564e700f909368">bio_is_call_cancelled</a>(msg); \</div>
<div class="line">            ++bio__svc_loop \</div>
<div class="line">        )</div>
<div class="ttc" id="agroup__mailbox_html_ga090313e3f82988032834b960b6af9697"><div class="ttname"><a href="group__mailbox.html#ga090313e3f82988032834b960b6af9697">bio_foreach_message</a></div><div class="ttdeci">#define bio_foreach_message(msg, mailbox)</div><div class="ttdoc">Convenient message loop macro.</div><div class="ttdef"><b>Definition</b> mailbox.h:245</div></div>
</div><!-- fragment -->
<p>Message loop helper for the service. </p>
<p>This should be used instead of manually receiving message. Refer to the example at the beginning of this section.</p>
<p>This will automatically do the following:</p>
<ul>
<li>Dropping cancelled messages</li>
<li>Break out if <a class="el" href="group__service.html#gadb9a8cd5a3721cd2ab34e4129de9fb93">bio_stop_service</a> is called </li>
</ul>

</div>
</div>
<a id="ga973c1cd2edcbf0afbe7d5f13b47a1c48" name="ga973c1cd2edcbf0afbe7d5f13b47a1c48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga973c1cd2edcbf0afbe7d5f13b47a1c48">&#9670;&#160;</a></span>BIO_SERVICE_MSG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BIO_SERVICE_MSG&#160;&#160;&#160;<a class="el" href="structbio__service__msg__base__t.html">bio_service_msg_base_t</a> bio__service_msg_base;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper to include <a class="el" href="structbio__service__msg__base__t.html">bio_service_msg_base_t</a> in a message type. </p>

</div>
</div>
<a id="ga1528d9454cb2120ca2914a863637b80e" name="ga1528d9454cb2120ca2914a863637b80e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1528d9454cb2120ca2914a863637b80e">&#9670;&#160;</a></span>bio_service_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_service_state</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">service</td><td>)</td>
          <td>&#160;&#160;&#160;	<a class="el" href="group__coro.html#gaed9911140a74eb570e214fcc0ecc44e7">bio_coro_state</a>((service).coro)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check a service's state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">service</td><td>A variable of type <a class="el" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A value of type <a class="el" href="group__coro.html#ga94f6989d9bb01e8af4b14575643ae55c">bio_coro_state_t</a> </dd></dl>

</div>
</div>
<a id="gad85fb81220dadbf8263aa7cc8ba33fa5" name="gad85fb81220dadbf8263aa7cc8ba33fa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad85fb81220dadbf8263aa7cc8ba33fa5">&#9670;&#160;</a></span>bio_start_service</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_start_service</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">entry, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">args, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mailbox_capacity&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    bio__service_start(\</div>
<div class="line">        &amp;(ptr)-&gt;coro, \</div>
<div class="line">        &amp;(ptr)-&gt;mailbox.bio__handle, \</div>
<div class="line">        <span class="keyword">sizeof</span>(*((ptr)-&gt;mailbox.bio__message)), \</div>
<div class="line">        mailbox_capacity, \</div>
<div class="line">        entry, \</div>
<div class="line">        &amp;args, \</div>
<div class="line">        <span class="keyword">sizeof</span>(args) \</div>
<div class="line">    )</div>
</div><!-- fragment -->
<p>Start a service coroutine. </p>
<p>The caller will suspend until the service has called <a class="el" href="group__service.html#ga0a5915441f5cf405f893a9eb22d3e3f0">bio_get_service_info</a>. This ensures that the stack allocated <code>args</code> has been copied from the caller's stack into the service's stack.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>Pointer to a variable of type <a class="el" href="group__service.html#ga1c4df06d5f793a5b6ec8b25221528d15">BIO_SERVICE</a> </td></tr>
    <tr><td class="paramname">entry</td><td>Entrypoint to the service </td></tr>
    <tr><td class="paramname">arg</td><td>Start argument to be passed to the service </td></tr>
    <tr><td class="paramname">mailbox_capacity</td><td>Mailbox capacity of the service</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__service.html#gadb9a8cd5a3721cd2ab34e4129de9fb93" title="Stop a service.">bio_stop_service</a> </dd>
<dd>
<a class="el" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c" title="Make a synchronous service call.">bio_call_service</a> </dd></dl>

</div>
</div>
<a id="gadb9a8cd5a3721cd2ab34e4129de9fb93" name="gadb9a8cd5a3721cd2ab34e4129de9fb93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadb9a8cd5a3721cd2ab34e4129de9fb93">&#9670;&#160;</a></span>bio_stop_service</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define bio_stop_service</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">service</td><td>)</td>
          <td>&#160;&#160;&#160;	bio__service_stop((service).coro, (service).mailbox.bio__handle)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop a service. </p>
<p>The caller will suspends until the targeted service has terminated. This is to ensure that the service can no longer refer to any shared resources that was passed through <a class="el" href="group__service.html#gad85fb81220dadbf8263aa7cc8ba33fa5">bio_start_service</a>. The caller may safely release them after this returns.</p>
<p>As with all bio's resources, stopping an already stopped service is not an error. </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gaa4b6b490e1bdb2b2eef15deca482ab12" name="gaa4b6b490e1bdb2b2eef15deca482ab12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa4b6b490e1bdb2b2eef15deca482ab12">&#9670;&#160;</a></span>bio_call_status_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__service.html#gaa4b6b490e1bdb2b2eef15deca482ab12">bio_call_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The status of a call using <a class="el" href="group__service.html#ga955af950234d8b2b422e64b78ca7c93c">bio_call_service</a>. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4" name="ggaa4b6b490e1bdb2b2eef15deca482ab12a4be7a21b90a6c858417778e0218239d4"></a>BIO_CALL_OK&#160;</td><td class="fielddoc"><p>The call was handled by the service. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggaa4b6b490e1bdb2b2eef15deca482ab12a1e5c49aece3542ff126e79a0eab9af7f" name="ggaa4b6b490e1bdb2b2eef15deca482ab12a1e5c49aece3542ff126e79a0eab9af7f"></a>BIO_CALL_CANCELLED&#160;</td><td class="fielddoc"><p>The call was cancelled by the caller. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggaa4b6b490e1bdb2b2eef15deca482ab12a162f386644d2fcd631612a606219a076" name="ggaa4b6b490e1bdb2b2eef15deca482ab12a162f386644d2fcd631612a606219a076"></a>BIO_CALL_TARGET_DEAD&#160;</td><td class="fielddoc"><p>The service has terminated during or before the call. </p>
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
